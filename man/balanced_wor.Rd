% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/balanced_wor.R
\name{balanced_wor}
\alias{balanced_wor}
\title{Balanced Sampling Without Replacement}
\usage{
balanced_wor(
  pik,
  aux = NULL,
  strata = NULL,
  method = c("cube"),
  nrep = 1L,
  ...
)
}
\arguments{
\item{pik}{A numeric vector of inclusion probabilities (length N).
\code{sum(pik)} must be close to an integer.}

\item{aux}{An optional numeric matrix (N x p) of auxiliary balancing
variables. Each column defines a balancing constraint. The sample
size constraint is always included automatically; \code{aux} specifies
additional variables to balance on.
When \code{NULL}, only the sample size is balanced (equivalent to an
unbalanced fixed-size design).}

\item{strata}{An optional integer vector (length N) of stratum
indicators (positive integers). When provided, uses the stratified
cube method (Chauvet & Tille, 2006; Chauvet, 2009) which preserves
within-stratum sample sizes while balancing on \code{aux}. Exact
preservation requires \code{sum(pik)} within each stratum to be close
to an integer; otherwise sizes will vary around the target and a
warning is issued and the design is marked as random-size
(\code{fixed_size = FALSE}), so batch replicates are returned as a list.}

\item{method}{The sampling method. Currently only \code{"cube"}.}

\item{nrep}{Number of replicate samples (default 1). When \code{nrep > 1},
\verb{$sample} holds a matrix (n x nrep) for fixed-size designs, or a
list of integer vectors when within-stratum sizes are not exact.}

\item{...}{Additional arguments passed to methods (e.g., \code{eps} for
boundary tolerance).}
}
\value{
An object of class \code{c("unequal_prob", "wor", "sondage_sample")}.
When \code{nrep = 1}, \verb{$sample} is an integer vector of selected unit
indices. When \code{nrep > 1}, \verb{$sample} is a matrix (n x nrep).
}
\description{
Draws a balanced sample using the cube method (Deville & Tille, 2004).
A balanced sample satisfies (approximately) the balancing equations
\eqn{\sum_{k \in S} x_k / \pi_k \approx \sum_{k \in U} x_k} for each
auxiliary variable \eqn{x}.
}
\details{
The cube method proceeds in two phases:
\describe{
\item{Flight phase}{Probabilities are moved toward 0 or 1 while
maintaining all balancing constraints. Each step resolves at
least one unit. Terminates when fewer than p+1 undecided units
remain.}
\item{Landing phase}{Remaining undecided units are resolved by
progressively relaxing balancing constraints, starting from the
\strong{last} column of \code{aux}. Users should order auxiliary
variables by importance (most important first).}
}

The sample size constraint is always placed first (never relaxed
during landing). For stratified designs, within-stratum size
constraints are also placed first.

Joint inclusion probabilities are approximated via the high-entropy
approximation (Brewer & Donadio, 2003), which is appropriate since
the cube produces a near-maximum-entropy design.
}
\examples{
# Unequal probability balanced sample
pik <- c(0.3, 0.6, 0.2, 0.4, 0.5)
x <- matrix(c(10, 20, 15, 25, 30))
set.seed(1)
s <- balanced_wor(pik, aux = x)
s$sample

# Stratified balanced sample
N <- 20
pik <- rep(0.4, N)
x <- matrix(as.double(1:N), ncol = 1)
strata <- rep(1:4, each = 5)
set.seed(1)
s <- balanced_wor(pik, aux = x, strata = strata)
s$sample

}
\references{
Deville, J.C. and Tille, Y. (2004). Efficient balanced sampling: the
cube method. \emph{Biometrika}, 91(4), 893-912.

Chauvet, G. and Tille, Y. (2006). A fast algorithm for balanced sampling.
\emph{Computational Statistics}, 21(1), 53-62.

Chauvet, G. (2009). Stratified balanced sampling. \emph{Survey
Methodology}, 35, 115-119.
}
\seealso{
\code{\link[=unequal_prob_wor]{unequal_prob_wor()}} for unbalanced designs,
\code{\link[=inclusion_prob]{inclusion_prob()}} to compute inclusion probabilities from size measures.
}
