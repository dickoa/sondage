% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generics.R
\name{sampling_cov}
\alias{sampling_cov}
\alias{sampling_cov.wor}
\alias{sampling_cov.wr}
\title{Sampling Covariance Matrix}
\usage{
sampling_cov(x, ...)

\method{sampling_cov}{wor}(x, scaled = FALSE, ...)

\method{sampling_cov}{wr}(x, scaled = FALSE, ...)
}
\arguments{
\item{x}{A sampling design object (class \code{"sondage_sample"}).}

\item{...}{Additional arguments passed to \code{\link[=joint_inclusion_prob]{joint_inclusion_prob()}} or
\code{\link[=joint_expected_hits]{joint_expected_hits()}}.}

\item{scaled}{If \code{FALSE} (default), returns the raw covariance matrix.
If \code{TRUE}, returns the scaled check quantities used in the
Sen-Yates-Grundy variance estimator.}
}
\value{
A symmetric N x N matrix. For WOR designs with \code{scaled = FALSE},
off-diagonal entries are typically negative for well-behaved designs.
With \code{scaled = TRUE}, off-diagonal entries are typically non-positive
(entries where \eqn{\pi_{ij} = 0} are set to \code{NA}).
}
\description{
Computes the sampling covariance matrix used in variance estimation.
}
\details{
For without-replacement designs:
\eqn{\Delta_{ij} = \pi_{ij} - \pi_i \pi_j}.

For with-replacement designs:
\eqn{E(n_i n_j) - E(n_i) E(n_j)}.

When \code{scaled = TRUE}, returns the Sen-Yates-Grundy check quantities:
\eqn{1 - \pi_i \pi_j / \pi_{ij}} for WOR,
\eqn{1 - E(n_i) E(n_j) / E(n_i n_j)} for WR.

\strong{Exact vs. approximate joint probabilities.}
The accuracy of the covariance matrix depends on the accuracy of
the underlying joint probabilities. For \code{cps}, \code{systematic}, \code{poisson},
\code{srs}, and \code{bernoulli}, the joint probabilities are exact and so is
the covariance matrix. For \code{brewer}, \code{sps}, and \code{pareto}, the joint
probabilities are based on the high-entropy approximation, so the
covariance matrix is also approximate. For \code{chromy}, the pairwise
expectations are simulation-based (controlled by \code{nsim}).
See \code{\link[=joint_inclusion_prob]{joint_inclusion_prob()}} and \code{\link[=joint_expected_hits]{joint_expected_hits()}} for details.

\strong{Zero joint inclusion probabilities.}
Some designs (notably systematic PPS) can produce \eqn{\pi_{ij} = 0}
for pairs of units that never co-occur in the same sample. When
\code{scaled = TRUE}, the quantity \eqn{1 - \pi_i \pi_j / \pi_{ij}} is
undefined for such pairs. These entries are set to \code{NA} and a
warning is issued. The raw covariance (\code{scaled = FALSE}) is
unaffected, since \eqn{\Delta_{ij} = 0 - \pi_i \pi_j} is finite.

\strong{Implications for variance estimation.}
The Sen-Yates-Grundy variance estimator requires all pairwise
\eqn{\pi_{ij} > 0} in the observed sample. It is not applicable for
designs with zero joint probabilities (a well-known limitation;
see Tille, 2006, Ch. 5). Consider alternative variance estimators
for such designs, e.g. successive-differences or Hartley-Rao
approximations.
}
\examples{
pik <- c(0.2, 0.3, 0.5)
s <- unequal_prob_wor(pik, method = "cps")

# Raw covariance
sampling_cov(s)

# SYG check quantities
sampling_cov(s, scaled = TRUE)

}
\references{
Chromy, J.R. (2009). Some generalizations of the Horvitz-Thompson
estimator. \emph{Memorial JSM}.

Tille, Y. (2006). \emph{Sampling Algorithms}. Springer.
}
