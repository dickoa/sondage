% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generics.R
\name{joint_expected_hits}
\alias{joint_expected_hits}
\alias{joint_expected_hits.wr}
\alias{joint_expected_hits.wor}
\alias{joint_expected_hits.default}
\title{Joint Expected Hits}
\usage{
joint_expected_hits(x, ...)

\method{joint_expected_hits}{wr}(x, sampled_only = FALSE, nsim = 10000L, ...)

\method{joint_expected_hits}{wor}(x, ...)

\method{joint_expected_hits}{default}(x, ...)
}
\arguments{
\item{x}{A with-replacement design object (class \code{"wr"}).}

\item{...}{Additional arguments passed to methods (e.g., \code{nsim}
for simulation-based methods).}

\item{sampled_only}{If \code{TRUE}, return only the submatrix for units
selected at least once (requires \code{nrep = 1}). Useful when N is
large but the number of distinct selected units is manageable.
Default \code{FALSE}.}

\item{nsim}{Number of simulations for Chromy's pairwise expectations
(default 10000).}
}
\value{
A symmetric N x N matrix (or n_s x n_s if
\code{sampled_only = TRUE}, where n_s is the number of distinct
selected units). Diagonal entries are \eqn{E(n_i^2)} and
off-diagonal entries are \eqn{E(n_i n_j)}.
}
\description{
Computes the matrix of pairwise expectations \eqn{E(n_i n_j)} for a
with-replacement sampling design, where \eqn{n_k} is the number of
times unit \eqn{k} is selected.
}
\details{
The computation depends on the sampling method:

\describe{
\item{Exact analytic}{\code{multinomial}
(\eqn{E(n_i n_j) = n(n-1) p_i p_j}) and \code{srs}
(\eqn{E(n_i n_j) = n(n-1)/N^2}).}
\item{Simulation-based}{\code{chromy}: pairwise expectations are
estimated by Monte Carlo simulation (controlled by the \code{nsim}
parameter, default 10 000). Increase \code{nsim} for more precise
estimates at the cost of computation time.}
}

When \code{sampled_only = TRUE}, the submatrix is indexed by population
units that were selected at least once (i.e., units with
\code{hits > 0}). For \code{multinomial} and \code{srs}, the submatrix is computed
directly at O(n_s^2). For \code{chromy}, the full N x N matrix is
computed internally and then subset.
}
\examples{
x <- c(40, 80, 50, 60, 70)
hits <- expected_hits(x, n = 3)
s <- unequal_prob_wr(hits, method = "chromy")
joint_expected_hits(s)

# Only the submatrix for selected units
joint_expected_hits(s, sampled_only = TRUE)

}
\seealso{
\code{\link[=joint_inclusion_prob]{joint_inclusion_prob()}} for the without-replacement analogue,
\code{\link[=sampling_cov]{sampling_cov()}} for the covariance matrix.
}
